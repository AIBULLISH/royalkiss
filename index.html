<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>$ROYALKISS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin:0;
  background: radial-gradient(circle at top, #2b1055, #000);
  color:white;
  font-family: Arial, sans-serif;
  text-align:center;
}
.container { max-width:900px; margin:auto; padding:20px; }
h1 { color:gold; font-size:3rem; text-shadow:0 0 20px gold; }
#stage { max-width:640px; margin:auto; }
video, canvas { width:100%; border-radius:16px; }
button {
  margin-top:20px;
  padding:16px 40px;
  font-size:1.2rem;
  border-radius:40px;
  border:none;
  cursor:pointer;
  background:gold;
  font-weight:bold;
}
#text { margin-top:20px; font-size:1.6rem; text-shadow:0 0 12px hotpink; }
#mint { display:none; background:linear-gradient(90deg, hotpink, gold); color:white; }
</style>
</head>

<body>
<div class="container">
<h1>$ROYALKISS</h1>

<div id="stage">
  <video id="video" autoplay muted playsinline></video>
  <canvas id="canvas"></canvas>
</div>

<div id="text">ARE YOU WORTHY?</div>
<button id="start">BECOME A PRINCE</button>
<button id="mint">JOIN THE KINGDOM</button>
</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const text = document.getElementById("text");
const startBtn = document.getElementById("start");
const mintBtn = document.getElementById("mint");

const knight = new Image(); knight.src = "knight.png";
const princess = new Image(); princess.src = "princess.png";
const crown = new Image(); crown.src = "crown.png";
const kiss = new Audio("kiss.mp3"); kiss.volume = 0.4;

let stream;
let faceCanvas;
let princessX;
let animating = false;

startBtn.onclick = async () => {
  text.innerText = "OPENING THE ROYAL CAMERA…";
  stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;

  video.onloadedmetadata = () => {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    text.innerText = "CAPTURING YOUR FACE…";
    setTimeout(capturePhoto, 1500);
  };
};

function capturePhoto() {
  const w = canvas.width;
  const h = canvas.height;

  faceCanvas = document.createElement("canvas");
  faceCanvas.width = w * 0.3;
  faceCanvas.height = w * 0.3;

  faceCanvas.getContext("2d").drawImage(
    video,
    w * 0.35, h * 0.25, w * 0.3, w * 0.3,
    0, 0, faceCanvas.width, faceCanvas.height
  );

  stream.getTracks().forEach(t => t.stop());
  drawPrince();
}

function drawPrince() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const knightX = canvas.width * 0.25;
  const knightY = canvas.height * 0.35;

  ctx.drawImage(knight, knightX, knightY, 300, 420);
  ctx.drawImage(faceCanvas, knightX + 95, knightY + 20, 110, 110);
  ctx.drawImage(crown, knightX + 70, knightY - 45, 160, 110);

  text.innerText = "YOU ARE THE PRINCE";
  setTimeout(startPrincess, 1000);
}

function startPrincess() {
  princessX = canvas.width;
  animating = true;
  animate();
}

function animate() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const knightX = canvas.width * 0.25;
  const knightY = canvas.height * 0.35;

  ctx.drawImage(knight, knightX, knightY, 300, 420);
  ctx.drawImage(faceCanvas, knightX + 95, knightY + 20, 110, 110);
  ctx.drawImage(crown, knightX + 70, knightY - 45, 160, 110);

  if (animating) {
    ctx.drawImage(princess, princessX, knightY, 300, 420);
    princessX -= 10;

    if (princessX <= knightX + 160) {
      animating = false;
      kiss.play();
      ctx.fillStyle = "rgba(255,105,180,0.25)";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      text.innerText = "THE PRINCESS HAS CHOSEN YOU";
      mintBtn.style.display = "inline-block";
      return;
    }
  }

  requestAnimationFrame(animate);
}
</script>
</body>
</html>
